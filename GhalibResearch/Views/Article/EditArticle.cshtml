@model AddOrEditArticleViewModel

<div class="section-wrapper tx-right" name="mydata">

    @if (TempData["Message"] != null)
    {
        <div class="alert alert-info" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
            <strong>پیام!</strong> @TempData["Message"]
        </div>
    }

    <form method="post" asp-controller="Article" asp-action="EditArticle" enctype="multipart/form-data">
        <div class="form-layout">
            <div class="row">
                <div class="col-lg-3">
                    <div class="form-group">
                        <label class="form-control-label">نوع تحقیق</label>
                        <select class="form-control" asp-items="Model.ArticleTypeList" name="ArticleTypeId" id="ArticleTypeId"></select>
                    </div>
                </div>
            </div>

            <div class="row mg-b-5">
                <div class="col-lg-12">
                    <div class="form-group">
                        <label class="form-control-label">عنوان مقاله</label>
                        <input type="hidden" name="ArticleId" required value="@Model.ArticleEditModel.ArticleId" />
                        <input class="form-control" type="text"  name="ArticleTitle" value="@Model.ArticleEditModel.ArticleTitle" placeholder="عنوان" autocomplete="off">
                    </div>
                </div><!-- col-6 -->
            </div>

            <div class="row mg-b-5">


                <div class="col-lg-3" id="AcademicCouncilProtocolNumber">
                    <div class="form-group">
                        <label class="form-control-label">نمبر پروتوکول شورای علمی</label>
                        <input class="form-control" type="text"  name="AcademicCouncilProtocolNumber" value="@Model.ArticleEditModel.AcademicCouncilProtocolNumber" autocomplete="off">
                    </div>
                </div>
                <div class="col-lg-3" id="AcademicCouncilProtocolDateString">
                    <div class="form-group">
                        <label class="form-control-label">تاریخ پروتوکل شورای علمی</label>
                        <input class="form-control shamsi-date-picker" type="text"  name="AcademicCouncilProtocolDateString" value="@(new ShamisDateTime.PersianDateTime(Model.ArticleEditModel.AcademicCouncilProtocolDate).ToShortDateString())"  autocomplete="off">
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="form-group">
                        <label class="form-control-label">نمبر پروتوکول  کمیته تحقیقات</label>
                        <input class="form-control" type="text" name="ResearchComitteeProtocolNumber"  value="@Model.ArticleEditModel.ResearchComitteeProtocolNumber" autocomplete="off">
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="form-group">
                        <label class="form-control-label">تاریخ پروتوکل کمیته تحقیقات</label>
                        <input class="form-control shamsi-date-picker" type="text"  name="ResearchComitteeProtocolDateString" value="@(new ShamisDateTime.PersianDateTime(Model.ArticleEditModel.ResearchComitteeProtocolDate).ToShortDateString())" autocomplete="off">
                    </div>
                </div>
            </div>

            <div class="row mg-b-5">

                <div class="col-lg-3">
                    <div class="form-group">
                        <label class="form-control-label">کد اخلاقی</label>
                        <input class="form-control" type="text" name="EthicCode"  value="@Model.ArticleEditModel.EthicCode" autocomplete="off">
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="form-group">
                        <label class="form-control-label">حمایت مالی</label>
                        <input class="form-control" type="text" name="Budget"  value="@Model.ArticleEditModel.Budget" autocomplete="off">
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="form-group">
                        <label class="form-control-label">پوهنځی</label>
                        <a id="btnAddNewFaculty" href="#" type="button" class="fa fa-plus-circle" data-toggle="modal" data-target="#add-faculty"></a>
                        <select class="form-control select2 " asp-items="Model.FacultyList" name="FacultyId" id="Faculty"></select>
                    </div>
                </div><!-- col-3 -->
                <div class="col-lg-3">
                    <div class="form-group">
                        <label class="form-control-label">دیپارتمنت</label>
                        <a id="btnAddNewDepartment" href="#" type="button" class="fa fa-plus-circle" data-toggle="modal" data-target="#add-department"></a>
                        <select class="form-control select2 " asp-items="Model.DepartmentList" name="DepartmentId" id="Department"></select>
                    </div>
                </div><!-- col-3 -->

            </div>

            <div class="row mg-b-5">
            </div><!-- row -->
            <div class="row mg-b-5">
                <div class="col-lg-3">
                    <div class="form-group">
                        <label class="form-control-label">سال نشر</label>
                        <input class="form-control" type="text"  required name="PublishedYearString" value="@Model.ArticleEditModel.PublishedYearString" autocomplete="off">
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="form-group">
                        <label class="form-control-label">شماره مجله</label>
                        <input class="form-control" type="text"  name="ChapterStartingNumber" value="@Model.ArticleEditModel.ChapterStartingNumber" autocomplete="off">
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="form-group">
                        <label class="form-control-label">تاریخ آغاز تحقیق</label>
                        <input class="form-control shamsi-date-picker"  type="text" name="StartingYearString" value="@(new ShamisDateTime.PersianDateTime(Model.ArticleEditModel.StartingYear).ToShortDateString())" autocomplete="off">
                    </div>
                </div><!-- col-3 -->
                <div class="col-lg-3">
                    <div class="form-group">
                        <label class="form-control-label">تاریخ پایان تحقیق</label>
                        <input class="form-control shamsi-date-picker"  type="text" name="EndingYearString" value="@(new ShamisDateTime.PersianDateTime(Model.ArticleEditModel.EndingYear).ToShortDateString())" autocomplete="off">
                    </div>
                </div>
            </div>

            <div class="row mg-b-5">
                <div class="col-lg-6">
                    <div class="form-group">
                        <label class="form-control-label">چاپ شده در ژورنال</label>
                        <input class="form-control" type="text"  name="PublishedInJournal" value="@Model.ArticleEditModel.PublishedInJournal" autocomplete="off">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div>
                        <object data="@Model.ArticleEditModel.AbstractFileString" width="300" height="200"></object>
                    </div>
                    <div class="form-group">
                        <label class="form-control-label">فایل چکیده</label>
                        <input class="form-control " type="file"  name="AbstractFile" value="">
                    </div>
                </div>
                <div class="col-lg-6">
                    <div>
                        <object data="@Model.ArticleEditModel.DocumentFileString" width="300" height="200"></object>
                    </div>
                    <div class="form-group">
                        <label class="form-control-label">فایل کامل</label>
                        <input class="form-control" type="file"  name="DocumentFile" value="">
                    </div>
                </div>

            </div>
        </div>
        <hr />

        <button id="btnAddNewMember" type="button" class="btn btn-info btn-sm bd-0" data-toggle="modal" data-target="#add-member"> <i class="fa fa-plus-circle"></i> افزودن عضو جدید</button>

        <fieldset>
            <div class="repeater-custom-show-hide">
                @{int counter = 0;}
                @foreach (var temp in Model.ArticleMemberList)
                {
                    @*<table>
                        <tr>
                            <td>@temp.MemberId</td>
                            <td>@temp.MemberTypeId</td>
                            <td>@temp.RoleId</td>
                        </tr>
                    </table>*@

                    <div data-repeater-list="Member">
                        <div data-repeater-item="">
                            <div class="form-group row d-flex align-items-end">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>انتخاب عضو</label>
                                        <select class="select2 form-control" id="MySelect" name="Member[counter][MemberId]" asp-items="Model.Member" ></select>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="form-control-label">نوع عضویت</label>
                                        <select class="form-control select2 " asp-items="Model.MemberType" name="Member[counter][MemberTypeId]" id="MemberTypeId" tabindex="1" aria-hidden="true">
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="form-control-label">رول</label>
                                        <select class="form-control select2 " asp-items="Model.Role" name="Member[counter][RoleId]" id="RoleId" tabindex="1" aria-hidden="true">
                                        </select>
                                    </div>
                                </div>
                                @{counter++; }
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <span data-repeater-delete="" class="btn btn-soft-danger btn-sm text-danger">
                                            <span class="far fa-trash-alt mr-1"></span> Delete
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!--end repet-list-->
                }

                <div class="form-group row mb-2">
                    <div class="col-sm-12">
                        <span data-repeater-create="" class="btn btn-soft-primary text-primary">
                            <span class="fa fa-plus alert-blue"></span> افزودن
                        </span>
                    </div>
                </div>

            </div> <!--end repeter-->

        </fieldset>

        <hr />

        <div class="form-layout-footer">
            <button type="submit" class="btn btn-primary"> <i class="fa fa-save"></i> ثبت مقاله </button>
        </div>
    </form>
    @await Html.PartialAsync("AddMember")
    @await Html.PartialAsync("AddFaculty")
    @await Html.PartialAsync("AddDepartment")

</div>

@section scripts{
    <script src="~/plugins/shamsidatepicker/datepicker.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.select2').select2();
           
            if ($("#ArticleTypeId").val() == 13) {
                $("#AcademicCouncilProtocolNumber").hide();
                $("#AcademicCouncilProtocolDateString").hide();
            }
            else {
                $("#AcademicCouncilProtocolNumber").show();
                $("#AcademicCouncilProtocolDateString").show();
            }

            $("input.shamsi-date-picker").persianDatepicker({ showGregorianDate: !1 });

            $('#Faculty').change(function () {
                var o2 = {
                    FacultyId: parseInt($(this).val())
                };
                var a = JSON.stringify(o2);
                 $.ajax({
                    url: "@Url.Action("GetDepartmentByFaculty", "Article")",
                    type: "POST",
                    cache: false,
                    data: a,
                    contentType: "application/json; charset=utf-8",
                    dataType: "Json",
                    success: function (data) {
                        var subjectSelect = $('#Department');
                        if (data != null && !jQuery.isEmptyObject(data)) {
                            subjectSelect.empty();
                            $.each(data, function (index, field) {
                                subjectSelect.append("<option value='" + field.value + "'>" + field.text + "</option>");
                            });
                        };
                    },
                    error: function (errormessage) {
                        alert(errormessage.responseText);
                    }
                });
            });

            $("button#btnSubmitform").click(function () {
                var dt = [];
                var o = {
                    FullName: $("#FullName").val(),
                    Email: $("#Email").val(),
                    PhoneNo: $("#PhoneNo").val(),
                    DegreeId: parseInt($("#DegreeId").val()),
                    EducationFieldId: parseInt($("#EducationFieldId").val()),
                    FacultyId: parseInt($("#FacultyId").val())

                };
                var a = JSON.stringify(o);
                $.ajax({
                    url: "@Url.Action("AddMember", "Article")",
                    type: "POST",
                    cache: false,
                    contentType: "application/json; charset=utf-8",
                    data: a,
                    success: function (data) {
                        $.ajax({
                            url: "@Url.Action("GetMemberList", "Article")",
                            type: "POST",
                            cache: false,
                            contentType: "application/json; charset=utf-8",
                            success: function (data) {
                                var subjectSelect = $('#MySelect');
                                if (data != null && !jQuery.isEmptyObject(data)) {
                                    subjectSelect.empty();
                                    subjectSelect.append($('<option />', {
                                        value: null,
                                        text: "---انتخاب عضو---"
                                    }));
                                    $.each(data, function (index, field) {
                                        subjectSelect.append("<option value='" + field.value + "'>" + field.text + "</option>");
                                    });
                                };
                            },
                            error: function (errormessage) {
                                alert(errormessage.responseText);
                            }
                        });
                    },
                    error: function (errormessage) {
                        alert(errormessage.responseText);
                    }

                });
            });
        });

         @*<---Adding Faculty--->*@

        $('#btnFacultyform').click(function () {
            $.when(sb()).done(function (a1) {
              ls();
            });

        });
        function sb() {
            var o2 = {
                FacultyName: $("#FacultyName").val(),
                FacultyNameEnglish: $("#FacultyNameEnglish").val()
            };
            var a = JSON.stringify(o2);
            $.ajax({
                url: "@Url.Action("AddFaculty", "Article")",
                type: "POST",
                cache: false,
                contentType: "application/json; charset=utf-8",
                data: a,
                success: function (data) {
                    alert(data.message);
                    ls();
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }

        function ls() {
            $.ajax({
                url: "@Url.Action("GetFacultyList", "Article")",
                type: "POST",
                cache: false,
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var facultySelect = $('#Faculty');
                    if (data != null && !jQuery.isEmptyObject(data)) {
                        facultySelect.empty();
                        facultySelect.append($('<option />', {
                            value: null,
                            text: "---انتخاب پوهنځی---"
                        }));
                        $.each(data, function (index, field) {
                            facultySelect.append("<option value='" + field.value + "'>" + field.text + "</option>");
                        });
                    };
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }

        @*<---Adding Faculty End--->*@





        @*<--Adding Department-->*@
        $('#btnDepartmentform').click(function () {
            $.when(dp()).done(function (a1) {
              lsdp();
            });

        });
        function dp() {
            var o2 = {
                DepartmentName: $("#DepartmentName").val(),
                FacultyId: $("#Faculty").val()
            };
            var a = JSON.stringify(o2);
            $.ajax({
                url: "@Url.Action("AddDepartment", "Article")",
                type: "POST",
                cache: false,
                contentType: "application/json; charset=utf-8",
                data: a,
                success: function (data) {
                    alert(data.message);
                    lsdp();
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }

        function lsdp() {
            var o2 = {
                FacultyId: $("#Faculty").val()
            };
            var a = JSON.stringify(o2);
            $.ajax({
                url: "@Url.Action("GetDepartmentByFaculty", "Article")",
                type: "POST",
                cache: false,
                contentType: "application/json; charset=utf-8",
                data:a,
                success: function (data) {
                    var departmentSelect = $('#Department');
                    if (data != null && !jQuery.isEmptyObject(data)) {
                        departmentSelect.empty();
                        departmentSelect.append($('<option />', {
                            value: null,
                            text: "---انتخاب دیپارتمنت---"
                        }));
                        $.each(data, function (index, field) {
                            departmentSelect.append("<option value='" + field.value + "'>" + field.text + "</option>");
                        });
                    };
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }

    </script>
}